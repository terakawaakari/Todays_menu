<%= form_with model: menu, local: true do |f| %>
  <div class="d-flex">
    <p class="col-4">画像</p>
    <div>
      <% if menu.errors.any? %>
        <% menu.errors.full_messages.each do |message| %>
          <p class="text-danger mb-2"><%= message %></p>
        <% end %>
      <% end %>
      <%= f.attachment_field :menu_image, placeholder: "ファイルを選択" %>
      <img id="menu-preview", class="my-3 col-8">
    </div>
  </div>

  <div class="d-flex mb-3">
    <p class="col-4">日付</p>
    <div><%= f.date_select :date, {use_month_numbers: true}, {class: "form-control form-control-sm d-inline-block w-auto"} %></div>
  </div>

  <div class="d-flex">
    <p class="col-4">カテゴリー</p>
    <div><%= f.select :category, Menu.categories.keys, {}, {class: "form-control form-control-sm"} %></div>
  </div>

  <div class="d-flex my-3">
    <p class="col-4">メニュー</p>
    <div><%= f.text_area :list, size: "40x5", placeholder: "・カレーライス\n・サラダ", class: "form-control" %></div>
  </div>

  <div class="d-flex my-3">
    <p class="col-4">マイレシピから選択</p>
    <div id="recipes">
      <%= f.fields_for :menu_recipes do |f| %>
        <%= render "menu_recipe_fields", f: f %>
      <% end %>
      <!--マイレシピから選択フォームの追加ボタン-->
      <div class="text-right mb-3">
        <%= link_to_add_association "+フォームを追加", f, :menu_recipes, class: "btn btn-sm btn-secondary" %>
      </div>
    </div>
  </div>

  <div class="text-center"><%= f.submit "メニューを保存", class: "btn btn-success" %></div>
<% end %>

<!--画像のプレビュー表示-->
<script>
  $('#menu_menu_image').on('change', function (e) {
    var reader = new FileReader();
    reader.onload = function (e) {
      $("#menu-preview").attr('src', e.target.result);
    }
    reader.readAsDataURL(e.target.files[0]);
  });
</script>

