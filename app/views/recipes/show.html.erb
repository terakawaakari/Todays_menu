<div class="container mt-5">
  <div class="row">
    <div class="col-lg-8 col-md-12 bg-white p-5 border recipe-show-container">
      <div class="d-block d-md-none"><%= render "responsive_search", title: "レシピ検索", q: @q %></div>

      <h2 class="mb-4 d-inline-block"><%= @recipe.name %></h2>
      <input type="button" value="レシピ詳細" onclick="clickBtn()" class="btn btn-sm btn-info ml-3">

      <!--レシピの詳細情報　ボタンクリックで表示-->
      <div id="details" class="mb-4">
        <div class="mb-1">ジャンル：<%= @recipe.genre %></div>
        <div class="mb-1">カテゴリー：<%= @recipe.category %></div>
        <div class="mb-1">味付け：<%= @recipe.taste %></div>
        <% if @recipe.time.present? %>
          <div class="mb-1">調理時間：<%= @recipe.time %> 分</div>
        <% end %>
        <% if @recipe.popularity.present? && @recipe.user_id == current_user.id %>
          <div class="mb-1" id="star-rate-<%= @recipe.id %>">人気度：</div>
        <% end %>
        <% if @tags.present? %>
          <div class="mb-1">タグ：
            <% @tags.each do |tag| %>
              <%= link_to "# #{tag.tag_name}　", tag_search_path(tag) %>
            <% end %>
          </div>
        <% end %>
        <% if @recipe.user_id == current_user.id %>
          <% if @recipe.is_open? %>
            <div class="mb-1">公開設定：公開中</div>
          <% else %>
            <div class="mb-1">公開設定：非公開</div>
          <% end %>
        <% end %>
      </div>

      <div class="d-flex ingredient">
        <div><%= attachment_image_tag @recipe, :recipe_image, size: '300x230', format:'jpeg', fallback: "no_image.png", class: "recipe-show-image" %></div>
        <!--材料-->
        <% if @ingredient.name.present? %>
          <div class="ml-4 ingredient-table">
            <h4 class="d-inline-block">材料　</h4>
            <% if @recipe.serving? %>
              <p class="d-inline-block">(<%= @recipe.serving %>)</p>
            <% end %>
            <table class="table">
              <tbody>
                <% @ingredients.each do |i| %>
                <tr>
                  <td><%= i.name %></td>
                  <td><%= i.quantity %></td>
                  <td>
                    <!--買い物リストへの追加ボタン-->
                    <%= form_with model: @item, local: true do |f| %>
                      <%= f.hidden_field :name, :value => i.name %>
                      <%= f.submit "＋", class: "btn btn-sm btn-success rounded-circle" %>
                    <% end %>
                  </td>
                </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
      <!--作り方-->
      <% if @direction.description.present? %>
        <div class="mt-5 direction">
          <h4>作り方</h4>
          <ol>
            <% @directions.each do |d| %>
              <li class="directions-list"><%= d.description %></li>
            <% end %>
          </ol>
        </div>
      <% end %>
      <!--メモ-->
      <% if @recipe.note.present? %>
        <div class="px-4 pb-4 border rounded">
          <div class="py-2">-memo-</div>
          <%= @recipe.note %>
        </div>
      <% end %>
      <!--URL-->
      <% if @recipe.url.present? %>
        <div class="mt-3">URL：<%= text_url_to_link(@recipe.url).html_safe %></div>
      <% end %>
      <!--ボタン-->
      <div class="text-right mt-3">
        <% if @recommend_main.present? || @recommend_sub.present? || @recommend_soup.present? %>
          <%= link_to "おすすめを見る", recipe_recommend_path(@recipe), remote: true, class: "btn btn-sm btn-info" %>
        <% end %>
        <% if @recipe.user_id == current_user.id || current_user.admin? %>
          <%= link_to "編集する", edit_recipe_path(@recipe), 'data-turbolinks': false, class: "btn btn-sm btn-success" %>
          <%= link_to "削除する", recipe_path(@recipe), method: :delete, data: {confirm: "削除しますか？"}, class: "btn btn-sm btn-danger" %>
        <% end %>
      </div>
      <!--おすすめレシピ-->
      <div id="recommend"></div>
    </div>

    <div class="col-lg-1"></div>
    <%= render "layouts/sidebar" %>
  </div>
</div>

<!--レシピ詳細の表示切り替え-->
<script>
document.getElementById("details").style.display ="none";

function clickBtn(){
	const details = document.getElementById("details");

	if(details.style.display == "block"){
		details.style.display = "none";
	}else{
		details.style.display = "block";
	}
}
</script>

<!--人気度の表示-->
<script>
  $("#star-rate-<%= @recipe.id %>").raty({
    starOff:  "<%= asset_path("star-off.png") %>",
    starOn : "<%= asset_path("star-on.png") %>",
    starHalf: "<%= asset_path("star-half.png") %>",
    half: true,
    readOnly: true,
    score: <%= @recipe.popularity %>
  });
</script>